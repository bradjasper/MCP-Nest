{"version":3,"file":"sse.controller.factory.js","sourceRoot":"","sources":["../../../src/mcp/transport/sse.controller.factory.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAyBA,kDA0DC;AAnFD,2CAewB;AAGxB,iEAA4D;AAC5D,oEAAgE;AAChE,oEAA8D;AAK9D,SAAgB,mBAAmB,CACjC,WAAmB,EACnB,gBAAwB,EACxB,SAAiB,EACjB,SAA8B,EAAE,EAChC,aAA+B,EAAE,EACjC,OAAoB;;IAEpB,IAIM,aAAa,qBAJnB,MAIM,aAAa;QAGjB,YACyC,UAAsB,EAC7C,aAA4B;YADL,eAAU,GAAV,UAAU,CAAY;YAC7C,kBAAa,GAAb,aAAa,CAAe;YAE5C,IAAI,CAAC,MAAM,GAAG,IAAA,oCAAe,EAAC,eAAa,CAAC,IAAI,EAAE,OAAO,IAAI,UAAU,CAAC,CAAC;QAC3E,CAAC;QAKD,YAAY;YACV,IAAI,CAAC,aAAa,CAAC,UAAU,EAAE,CAAC;QAClC,CAAC;QAOK,AAAN,KAAK,CAAC,GAAG,CAAQ,MAAW,EAAS,MAAW;YAC9C,OAAO,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAC3C,MAAM,EACN,MAAM,EACN,gBAAgB,EAChB,SAAS,CACV,CAAC;QACJ,CAAC;QAOK,AAAN,KAAK,CAAC,QAAQ,CACL,MAAW,EACX,MAAW,EACV,IAAa;YAErB,MAAM,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;QAC/D,CAAC;KACF,CAAA;IArBO;QAFL,IAAA,YAAG,EAAC,IAAA,sCAAiB,EAAC,GAAG,SAAS,IAAI,WAAW,EAAE,CAAC,CAAC;QACrD,IAAA,kBAAS,EAAC,GAAG,MAAM,CAAC;QACV,WAAA,IAAA,YAAG,GAAE,CAAA;QAAe,WAAA,IAAA,YAAG,GAAE,CAAA;;;;4CAOnC;IAOK;QAFL,IAAA,aAAI,EAAC,IAAA,sCAAiB,EAAC,GAAG,SAAS,IAAI,gBAAgB,EAAE,CAAC,CAAC;QAC3D,IAAA,kBAAS,EAAC,GAAG,MAAM,CAAC;QAElB,WAAA,IAAA,YAAG,GAAE,CAAA;QACL,WAAA,IAAA,YAAG,GAAE,CAAA;QACL,WAAA,IAAA,aAAI,GAAE,CAAA;;;;iDAGR;IA1CG,aAAa;QAJlB,IAAA,mBAAU,EAAC;YACV,OAAO,EAAE,wBAAe;SACzB,CAAC;QACD,IAAA,wBAAe,EAAC,GAAG,UAAU,CAAC;QAK1B,WAAA,IAAA,eAAM,EAAC,aAAa,CAAC,CAAA;iDACS,+BAAa;OAL1C,aAAa,CA2ClB;IAED,OAAO,aAAa,CAAC;AACvB,CAAC","sourcesContent":["import {\n  Body,\n  CanActivate,\n  Controller,\n  Get,\n  Inject,\n  Logger,\n  OnModuleInit,\n  Post,\n  Req,\n  Res,\n  Type,\n  UseGuards,\n  VERSION_NEUTRAL,\n  applyDecorators,\n} from '@nestjs/common';\n\nimport type { McpOptions } from '../interfaces';\nimport { McpSseService } from '../services/mcp-sse.service';\nimport { normalizeEndpoint } from '../utils/normalize-endpoint';\nimport { createMcpLogger } from '../utils/mcp-logger.factory';\n\n/**\n * Creates a controller for handling SSE connections and tool executions\n */\nexport function createSseController(\n  sseEndpoint: string,\n  messagesEndpoint: string,\n  apiPrefix: string,\n  guards: Type<CanActivate>[] = [],\n  decorators: ClassDecorator[] = [],\n  options?: McpOptions,\n) {\n  @Controller({\n    version: VERSION_NEUTRAL,\n  })\n  @applyDecorators(...decorators)\n  class SseController implements OnModuleInit {\n    readonly logger: Logger;\n\n    constructor(\n      @Inject('MCP_OPTIONS') public readonly mcpOptions: McpOptions,\n      public readonly mcpSseService: McpSseService,\n    ) {\n      this.logger = createMcpLogger(SseController.name, options || mcpOptions);\n    }\n\n    /**\n     * Initialize the controller and configure SSE service\n     */\n    onModuleInit() {\n      this.mcpSseService.initialize();\n    }\n\n    /**\n     * SSE connection endpoint\n     */\n    @Get(normalizeEndpoint(`${apiPrefix}/${sseEndpoint}`))\n    @UseGuards(...guards)\n    async sse(@Req() rawReq: any, @Res() rawRes: any) {\n      return this.mcpSseService.createSseConnection(\n        rawReq,\n        rawRes,\n        messagesEndpoint,\n        apiPrefix,\n      );\n    }\n\n    /**\n     * Tool execution endpoint - protected by the provided guards\n     */\n    @Post(normalizeEndpoint(`${apiPrefix}/${messagesEndpoint}`))\n    @UseGuards(...guards)\n    async messages(\n      @Req() rawReq: any,\n      @Res() rawRes: any,\n      @Body() body: unknown,\n    ): Promise<void> {\n      await this.mcpSseService.handleMessage(rawReq, rawRes, body);\n    }\n  }\n\n  return SseController;\n}\n"]}