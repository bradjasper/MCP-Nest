{"version":3,"file":"stdio.service.js","sourceRoot":"","sources":["../../../src/mcp/transport/stdio.service.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA,wEAAiF;AACjF,2CAKwB;AACxB,uCAA2D;AAC3D,8CAAiD;AAEjD,2EAAsE;AACtE,2EAAsE;AACtE,oEAA8D;AAC9D,oEAA8D;AAGvD,IAAM,YAAY,oBAAlB,MAAM,YAAY;IAGvB,YAC0C,OAAmB,EACjB,WAAmB,EAC5C,SAAoB,EACpB,YAAgC;QAHT,YAAO,GAAP,OAAO,CAAY;QACjB,gBAAW,GAAX,WAAW,CAAQ;QAC5C,cAAS,GAAT,SAAS,CAAW;QACpB,iBAAY,GAAZ,YAAY,CAAoB;QAEjD,IAAI,CAAC,MAAM,GAAG,IAAA,oCAAe,EAAC,cAAY,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;IACjE,CAAC;IAED,KAAK,CAAC,sBAAsB;QAC1B,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,KAAK,6BAAgB,CAAC,KAAK,EAAE,CAAC;YACtD,OAAO;QACT,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;QAE9C,MAAM,SAAS,GAAG,IAAA,oCAAe,EAC/B,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,MAAM,CACZ,CAAC;QAEF,MAAM,SAAS,GAAG,uBAAgB,CAAC,MAAM,EAAE,CAAC;QAC5C,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,OAAO,CAC3C,yCAAkB,EAClB,SAAS,EACT,EAAE,MAAM,EAAE,KAAK,EAAE,CAClB,CAAC;QAGF,QAAQ,CAAC,uBAAuB,CAAC,SAAS,EAAE,EAAS,CAAC,CAAC;QAEvD,MAAM,SAAS,GAAG,IAAI,+BAAoB,EAAE,CAAC;QAC7C,MAAM,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QAEnC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;IACrC,CAAC;CACF,CAAA;AAxCY,oCAAY;uBAAZ,YAAY;IADxB,IAAA,mBAAU,GAAE;IAKR,WAAA,IAAA,eAAM,EAAC,aAAa,CAAC,CAAA;IACrB,WAAA,IAAA,eAAM,EAAC,eAAe,CAAC,CAAA;qDACI,gBAAS;QACN,yCAAkB;GAPxC,YAAY,CAwCxB","sourcesContent":["import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';\nimport {\n  Inject,\n  Injectable,\n  Logger,\n  OnApplicationBootstrap,\n} from '@nestjs/common';\nimport { ContextIdFactory, ModuleRef } from '@nestjs/core';\nimport { McpTransportType } from '../interfaces';\nimport type { McpOptions } from '../interfaces';\nimport { McpExecutorService } from '../services/mcp-executor.service';\nimport { McpRegistryService } from '../services/mcp-registry.service';\nimport { createMcpLogger } from '../utils/mcp-logger.factory';\nimport { createMcpServer } from '../utils/mcp-server.factory';\n\n@Injectable()\nexport class StdioService implements OnApplicationBootstrap {\n  private readonly logger: Logger;\n\n  constructor(\n    @Inject('MCP_OPTIONS') private readonly options: McpOptions,\n    @Inject('MCP_MODULE_ID') private readonly mcpModuleId: string,\n    private readonly moduleRef: ModuleRef,\n    private readonly toolRegistry: McpRegistryService,\n  ) {\n    this.logger = createMcpLogger(StdioService.name, this.options);\n  }\n\n  async onApplicationBootstrap() {\n    if (this.options.transport !== McpTransportType.STDIO) {\n      return;\n    }\n    this.logger.log('Bootstrapping MCP STDIO...');\n\n    const mcpServer = createMcpServer(\n      this.mcpModuleId,\n      this.toolRegistry,\n      this.options,\n      this.logger,\n    );\n\n    const contextId = ContextIdFactory.create();\n    const executor = await this.moduleRef.resolve(\n      McpExecutorService,\n      contextId,\n      { strict: false },\n    );\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    executor.registerRequestHandlers(mcpServer, {} as any);\n\n    const transport = new StdioServerTransport();\n    await mcpServer.connect(transport);\n\n    this.logger.log('MCP STDIO ready');\n  }\n}\n"]}