{"version":3,"file":"mcp-executor.service.js","sourceRoot":"","sources":["../../../src/mcp/services/mcp-executor.service.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;AACA,2CAA6E;AAC7E,uCAAyC;AACzC,iEAA4D;AAC5D,oEAA+D;AAC/D,4EAAuE;AACvE,wEAAmE;AAEnE,6EAAwE;AAExE,oEAA8D;AAMvD,IAAM,kBAAkB,0BAAxB,MAAM,kBAAkB;IAM7B,YACE,SAAoB,EACpB,QAA4B,EACH,WAAmB,EACrB,OAAmB,EAC1C,WAAqC;QAErC,IAAI,CAAC,MAAM,GAAG,IAAA,oCAAe,EAAC,oBAAkB,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QAChE,IAAI,CAAC,YAAY,GAAG,IAAI,mCAAe,CACrC,SAAS,EACT,QAAQ,EACR,WAAW,EACX,OAAO,EACP,WAAW,CACZ,CAAC;QACF,IAAI,CAAC,gBAAgB,GAAG,IAAI,2CAAmB,CAC7C,SAAS,EACT,QAAQ,EACR,WAAW,CACZ,CAAC;QACF,IAAI,CAAC,cAAc,GAAG,IAAI,uCAAiB,CACzC,SAAS,EACT,QAAQ,EACR,WAAW,CACZ,CAAC;IACJ,CAAC;IAOD,uBAAuB,CAAC,SAAoB,EAAE,WAAwB;QACpE,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;QAC3D,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;QAC/D,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;IAC/D,CAAC;CACF,CAAA;AA3CY,gDAAkB;6BAAlB,kBAAkB;IAD9B,IAAA,mBAAU,EAAC,EAAE,KAAK,EAAE,cAAK,CAAC,OAAO,EAAE,CAAC;IAUhC,WAAA,IAAA,eAAM,EAAC,eAAe,CAAC,CAAA;IACvB,WAAA,IAAA,eAAM,EAAC,aAAa,CAAC,CAAA;qCAHX,gBAAS;QACV,yCAAkB,kBAGf,qDAAwB;GAX5B,kBAAkB,CA2C9B","sourcesContent":["import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport { Inject, Injectable, Logger, Optional, Scope } from '@nestjs/common';\nimport { ModuleRef } from '@nestjs/core';\nimport { McpRegistryService } from './mcp-registry.service';\nimport { McpToolsHandler } from './handlers/mcp-tools.handler';\nimport { McpResourcesHandler } from './handlers/mcp-resources.handler';\nimport { McpPromptsHandler } from './handlers/mcp-prompts.handler';\nimport { HttpRequest } from '../interfaces/http-adapter.interface';\nimport { ToolAuthorizationService } from './tool-authorization.service';\nimport type { McpOptions } from '../interfaces/mcp-options.interface';\nimport { createMcpLogger } from '../utils/mcp-logger.factory';\n\n/**\n * Request-scoped service for executing MCP tools\n */\n@Injectable({ scope: Scope.REQUEST })\nexport class McpExecutorService {\n  private logger: Logger;\n  private toolsHandler: McpToolsHandler;\n  private resourcesHandler: McpResourcesHandler;\n  private promptsHandler: McpPromptsHandler;\n\n  constructor(\n    moduleRef: ModuleRef,\n    registry: McpRegistryService,\n    @Inject('MCP_MODULE_ID') mcpModuleId: string,\n    @Inject('MCP_OPTIONS') options: McpOptions,\n    authService: ToolAuthorizationService,\n  ) {\n    this.logger = createMcpLogger(McpExecutorService.name, options);\n    this.toolsHandler = new McpToolsHandler(\n      moduleRef,\n      registry,\n      mcpModuleId,\n      options,\n      authService,\n    );\n    this.resourcesHandler = new McpResourcesHandler(\n      moduleRef,\n      registry,\n      mcpModuleId,\n    );\n    this.promptsHandler = new McpPromptsHandler(\n      moduleRef,\n      registry,\n      mcpModuleId,\n    );\n  }\n\n  /**\n   * Register tool-related request handlers with the MCP server\n   * @param mcpServer - The MCP server instance\n   * @param request - The current HTTP request object\n   */\n  registerRequestHandlers(mcpServer: McpServer, httpRequest: HttpRequest) {\n    this.toolsHandler.registerHandlers(mcpServer, httpRequest);\n    this.resourcesHandler.registerHandlers(mcpServer, httpRequest);\n    this.promptsHandler.registerHandlers(mcpServer, httpRequest);\n  }\n}\n"]}