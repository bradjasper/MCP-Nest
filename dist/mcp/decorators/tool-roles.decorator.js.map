{"version":3,"file":"tool-roles.decorator.js","sourceRoot":"","sources":["../../../src/mcp/decorators/tool-roles.decorator.ts"],"names":[],"mappings":";;;AAAA,2CAA6C;AAKhC,QAAA,sBAAsB,GAAG,WAAW,CAAC;AAkC3C,MAAM,SAAS,GAAG,CAAC,KAAe,EAAE,EAAE;IAC3C,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QAChD,MAAM,IAAI,KAAK,CAAC,yDAAyD,CAAC,CAAC;IAC7E,CAAC;IACD,OAAO,IAAA,oBAAW,EAAC,8BAAsB,EAAE,KAAK,CAAC,CAAC;AACpD,CAAC,CAAC;AALW,QAAA,SAAS,aAKpB","sourcesContent":["import { SetMetadata } from '@nestjs/common';\n\n/**\n * Metadata key for storing required roles\n */\nexport const MCP_ROLES_METADATA_KEY = 'mcp:roles';\n\n/**\n * Decorator to specify roles required to access a tool.\n *\n * Use this to restrict tool access based on user roles (RBAC).\n * When applied, it requires the authenticated user to have\n * ALL specified roles in their JWT token or user profile.\n *\n * Can be combined with @ToolScopes() for fine-grained access control.\n *\n * @param roles - Array of required role strings\n *\n * @example\n * ```typescript\n * @Injectable()\n * export class MyTools {\n *   // Requires 'admin' role\n *   @Tool({ name: 'system-config', description: 'Configure system' })\n *   @ToolRoles(['admin'])\n *   async configureSystem(args, ctx, req: McpRequestWithUser) {\n *     return { content: [{ type: 'text', text: 'System configured' }] };\n *   }\n *\n *   // Requires both role and scope\n *   @Tool({ name: 'audit-log', description: 'View audit logs' })\n *   @ToolRoles(['auditor'])\n *   @ToolScopes(['logs.read'])\n *   async viewAuditLog(args, ctx, req: McpRequestWithUser) {\n *     return { content: [{ type: 'text', text: 'Audit log data...' }] };\n *   }\n * }\n * ```\n */\nexport const ToolRoles = (roles: string[]) => {\n  if (!Array.isArray(roles) || roles.length === 0) {\n    throw new Error('@ToolRoles() requires a non-empty array of role strings');\n  }\n  return SetMetadata(MCP_ROLES_METADATA_KEY, roles);\n};\n"]}