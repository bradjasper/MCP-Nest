{"version":3,"file":"tool-scopes.decorator.js","sourceRoot":"","sources":["../../../src/mcp/decorators/tool-scopes.decorator.ts"],"names":[],"mappings":";;;AAAA,2CAA6C;AAKhC,QAAA,uBAAuB,GAAG,YAAY,CAAC;AAuC7C,MAAM,UAAU,GAAG,CAAC,MAAgB,EAAE,EAAE;IAC7C,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QAClD,MAAM,IAAI,KAAK,CACb,2DAA2D,CAC5D,CAAC;IACJ,CAAC;IACD,OAAO,IAAA,oBAAW,EAAC,+BAAuB,EAAE,MAAM,CAAC,CAAC;AACtD,CAAC,CAAC;AAPW,QAAA,UAAU,cAOrB","sourcesContent":["import { SetMetadata } from '@nestjs/common';\n\n/**\n * Metadata key for storing required OAuth scopes\n */\nexport const MCP_SCOPES_METADATA_KEY = 'mcp:scopes';\n\n/**\n * Decorator to specify OAuth scopes required to access a tool.\n *\n * Use this to restrict tool access based on OAuth permissions (Scopes).\n * When applied, it requires the authenticated user to have\n * ALL specified scopes in their JWT token.\n *\n * Can be combined with @PublicTool() to create tools that work better with authentication\n * but are also accessible anonymously.\n *\n * @param scopes - Array of required OAuth scope strings\n *\n * @example\n * ```typescript\n * @Injectable()\n * export class MyTools {\n *   // Requires 'admin' and 'write' scopes\n *   @Tool({ name: 'delete-user', description: 'Delete a user' })\n *   @ToolScopes(['admin', 'write'])\n *   async deleteUser(args, ctx, req: McpRequestWithUser) {\n *     // Only users with both 'admin' AND 'write' scopes can call this\n *     return { content: [{ type: 'text', text: 'User deleted' }] };\n *   }\n *\n *   // Optional auth - works better with 'premium' scope\n *   @Tool({ name: 'search', description: 'Search content' })\n *   @PublicTool()\n *   @ToolScopes(['premium'])\n *   async search(args, ctx, req: McpRequestWithUser) {\n *     if (req.user?.scopes?.includes('premium')) {\n *       return { content: [{ type: 'text', text: 'AI-powered results' }] };\n *     }\n *     return { content: [{ type: 'text', text: 'Basic results' }] };\n *   }\n * }\n * ```\n */\nexport const ToolScopes = (scopes: string[]) => {\n  if (!Array.isArray(scopes) || scopes.length === 0) {\n    throw new Error(\n      '@ToolScopes() requires a non-empty array of scope strings',\n    );\n  }\n  return SetMetadata(MCP_SCOPES_METADATA_KEY, scopes);\n};\n"]}